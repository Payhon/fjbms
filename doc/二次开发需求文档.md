## 1.1 项目目标

基于本项目 ThingsPanel 二次开发构建一套集** ****WEB端管理平台** 与** ****多端APP终端** 于一体的BMS物联网系统，实现电池设备全生命周期管理（出厂分配、经销商转移、终端激活、状态监控、维保管理、OTA升级），打通“厂家-经销商-终端用户”的信息链路，提升设备管理效率与用户体验。

## 1.2 核心角色


| **角色**     | **权限范围**                                                                |
| ------------ | --------------------------------------------------------------------------- |
| 厂家管理员   | 系统全权限（设备分配、经销商管理、权限配置、数据查看、OTA下发、维保审批等） |
| 经销商管理员 | 名下设备管理、终端用户管理、设备转移、维保申请提交、数据查看（仅限名下）    |
| 终端用户     | 设备激活绑定、状态查看、蓝牙/MQTT连接、OTA升级、维保申请提交                |

## 1.3 系统架构

-** ****WEB端**：浏览器访问，基于B/S架构，支持PC端主流浏览器

-** ****APP端**：支持微信小程序、Android（8.0+）、iOS（13.0+），采用混合开发模式（原生+H5）

-** ****设备通信**：蓝牙（BLE 5.0+）用于近距离实时数据交互，MQTT（3.1.1+）用于远程数据上报/指令接收

-** ****数据存储**：云端PostgreSQL数据库存储设备、用户、告警、维保等数据，支持高并发与实时查询

# 一、功能需求

## 2.1 WEB端功能需求

### 2.1.1 首页面板（厂家/经销商视角差异化显示）


| **功能项**   | **详细描述**                                                                                                                                                                                                  |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 核心指标统计 | 厂家视角：设备总数、在线数（实时连接平台）、激活数（终端绑定）、过保设备数、已售设备数、已转移设备数、未转移设备数、经销商总数、终端用户总数<br/>经销商视角：名下设备总数、在线数、激活数、过保数、终端用户数 |
| 设备分布地图 | 1. 支持全国/区域筛选（省、市、区）；<br/>2. 按设备状态（在线/离线/告警）标注颜色；<br/>3. 点击设备图标显示核心信息（序列号、型号、SOC、告警状态）                                                             |
| 告警概览     | 显示今日/近7日告警总数、告警级别分布（紧急/重要/一般）、Top3告警类型（过压/过温/电芯不均衡等）                                                                                                                |
| 数据趋势图   | 设备在线率、激活率、告警率趋势（支持按日/周/月筛选）                                                                                                                                                          |
| 快捷操作入口 | 电池导入、经销商添加、OTA升级下发、维保审批入口                                                                                                                                                               |

### 2.1.2 电池管理（核心模块）

#### 2.1.2.1 电池列表


| **功能项**   | **详细描述**                                                                                                                                                                                                                                      |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 多条件查询   | 支持筛选条件：序列号（精确/模糊）、电池型号、设备状态（在线/离线）、激活状态（已激活/未激活）、经销商（下拉选择）、出厂日期（时间范围）、质保状态（在保/过保）                                                                                    |
| 列表字段展示 | 序列号、型号、出厂日期、经销商名称、终端用户名、激活时间、在线状态、SOC（剩余电量）、SOH（健康状态）、质保到期日、当前固件版本、操作                                                                                                              |
| 批量操作     | 1. 批量导入：支持Excel模板导入（必填字段：序列号、型号、出厂日期、额定电压、质保期（月）），导入后支持批量分配给经销商；<br/>2. 批量导出：导出当前筛选结果为Excel；<br/>3. 批量下发指令（重启、休眠、清除告警)4. OTA设备列表管理(实现批量OTA推送) |
| 单设备操作   | 1. 查看详情：进入设备详情页；<br/>2. 转移经销商：下拉选择目标经销商（仅厂家权限）；<br/>3. 下发OTA升级：选择固件版本下发；<br/>4. 离线指令：存储指令，设备上线后执行<br/>5. 参数远程查看和修改                                                   |

#### 2.1.2.2 电池型号


| **功能项** | **详细描述**                                                                                                                                                                                                            |
| ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 型号管理   | 1. 新增：填写型号名称、额定电压、额定容量、电芯数量、标称功率、默认质保期（月）、备注；2. 编辑/删除：仅厂家权限，已关联设备的型号不可删除；<br/>3. 列表展示：型号名称、额定电压、额定容量、电芯数量、质保期、关联设备数 |

#### 2.1.2.3 标签列表


| **功能项** | **详细描述**                                                                                                                                                |
| ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 标签管理   | 1.新增：标签名称、标签颜色、适用场景（如“户外使用”“快充型”）；2.编辑/删除；3. 设备关联：支持给设备批量/单个添加标签，列表展示标签名称、关联设备数、操作 |

#### 2.1.2.4 转移记录


| **功能项** | **详细描述**                                                         |
| ---------- | -------------------------------------------------------------------- |
| 记录查询   | 筛选条件：设备序列号、原经销商、目标经销商、转移时间（范围）、操作人 |
| 记录字段   | 设备序列号、型号、原经销商、目标经销商、转移时间、操作人、备注       |

#### 2.1.2.5 离线指令


| **功能项** | **详细描述**                                                                                                                                                                                            |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 指令管理   | 1.指令列表：设备序列号、指令类型（重启/休眠/OTA升级/清除告警）、下发时间、操作人、执行状态（待执行/已执行/执行失败）、执行时间；2.查看详情：显示指令内容、设备响应结果；3. 撤销指令：未执行的指令可撤销 |

### 2.1.3 维保管理

#### 2.1.3.1 用户维保


| **功能项**   | **详细描述**                                                                                                                                                                                                                                                                                                   |
| ------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 维保申请处理 | 1.申请列表：筛选条件（设备序列号、申请人、申请状态、申请时间）；2.列表字段：申请ID、设备序列号、申请人、申请时间、故障描述、附件（图片）、处理状态（待审核/审核通过/维修中/已完成/已驳回）、处理人、处理时间；3. 操作：审核（通过/驳回，填写驳回原因）、分配维修、填写维修结果（故障原因、解决方案、更换配件） |

#### 2.1.3.2 电池维保


| **功能项**   | **详细描述**                                                                                                                                                                                                                  |
| ------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 维保记录管理 | 1.新增记录：手动录入设备序列号、故障类型、维修时间、维修人员、解决方案、配件更换清单；2.列表展示：设备序列号、型号、故障类型、维修时间、维修人员、质保影响（是否影响质保）；3. 关联查询：可通过设备序列号关联查看所有维保记录 |

#### 2.1.3.3 激活日志


| **功能项** | **详细描述**                                                                                 |
| ---------- | -------------------------------------------------------------------------------------------- |
| 日志查询   | 筛选条件：设备序列号、激活用户、激活时间（范围）、激活方式（APP扫码/WEB手动）                |
| 日志字段   | 设备序列号、型号、激活用户（手机号）、激活时间、激活方式、绑定终端设备（APP/小程序）、IP地址 |

#### 2.1.3.4 退换货记录


| **功能项** | **详细描述**                                                                                                                                                                                                             |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 退换货管理 | 1.申请列表：筛选条件（设备序列号、申请人、申请类型（退货/换货）、处理状态）；2.列表字段：申请ID、设备序列号、申请人、申请类型、申请时间、原因、处理状态、处理结果、处理人；3. 操作：审核（通过/驳回）、确认退货/换货完成 |

### 2.1.4 经销商管理

#### 2.1.4.1 经销商列表


| **功能项** | **详细描述**                                                                                                                                                                                                                                                      |
| ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 经销商管理 | 1.新增：填写经销商名称、联系人、手机号、邮箱、所在区域（省/市/区）、地址、备注，设置登录账号（手机号）和初始密码；2.编辑/禁用：禁用后账号无法登录；3. 列表字段：经销商名称、联系人、手机号、所在区域、设备总数、激活设备数、注册时间、账号状态（启用/禁用）、操作 |
| 数据查看   | 点击经销商名称，查看其名下设备、终端用户、维保记录统计                                                                                                                                                                                                            |

#### 2.1.4.2 终端用户


| **功能项** | **详细描述**                                                                                                                                                                             |
| ---------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 用户列表   | 筛选条件：手机号、所属经销商、注册时间、绑定设备数；1.列表字段：用户ID、手机号、所属经销商、注册时间、绑定设备数、最后登录时间；3. 操作：查看绑定设备、强制解绑设备（仅厂家/经销商权限） |

#### 2.1.4.3 授权管理


| **功能项**     | **详细描述**                                                                                                                                                                                     |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 经销商权限配置 | 1.预设权限模板：基础版（设备查看、终端用户管理）、高级版（含设备转移、维保申请）；2.自定义权限：勾选可分配权限（如“设备转移”“OTA下发”“维保审批”）；3. 权限生效：配置后实时同步到经销商账号 |

### 2.1.5 运营管理

#### 2.1.5.1** **操作记录


| **功能项**   | **详细描述**                                                                                                                                                                                                                     |
| ------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 操作日志查询 | 1.筛选条件：操作人、操作模块（电池管理/经销商管理/系统管理等）、操作类型（新增/编辑/删除/下发指令等）、操作时间（范围）；2. 日志字段：操作时间、操作人、所属角色、操作模块、操作类型、操作内容（如“批量导入10台设备”）、IP地址 |

### 2.1.6 系统管理

#### 2.1.6.1 账号管理


| **功能项** | **详细描述**                                                                                                                                                                                                                     |
| ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 账号管理   | 1.新增账号：选择角色（厂家管理员/经销商管理员）、填写手机号、设置初始密码、关联经销商（仅经销商管理员需关联）；2.编辑/重置密码/禁用：重置密码后通知用户；3. 列表字段：账号ID、手机号、角色、所属经销商、注册时间、账号状态、操作 |

#### 2.1.6.2 角色管理


| **功能项** | **详细描述**                                                                                                                                                                           |
| ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 角色配置   | 1.预设角色：厂家管理员（全权限）、经销商管理员（自定义权限）、终端用户（仅设备查看/操作）；2.自定义角色：新增角色名称，勾选权限项（按模块细分）；3. 权限预览：查看角色已拥有的权限清单 |

### 2.1.7 定制服务

#### 2.1.7.1 激活记录


| **功能项**   | **详细描述**                                                                                                                    |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------- |
| 激活数据统计 | 1.统计维度：按日期/经销商/设备型号统计激活数量；2.导出报表：支持按维度导出激活统计数据；3. 详情查看：关联激活日志，支持穿透查询 |

#### 2.1.7.2 出厂记录


| **功能项**   | **详细描述**                                                                                                                 |
| ------------ | ---------------------------------------------------------------------------------------------------------------------------- |
| 出厂数据管理 | 1.列表展示：出厂批次、设备序列号、型号、出厂日期、质检员、测试数据（电压/电流）；2. 查询筛选：按出厂批次、日期范围、型号筛选 |


## 2.1 APP端（含微信小程序、Android、iOS）功能需求

### 2.2.1 登录/注册/密码找回

#### 2.2.1.1 登录页


| **功能项** | **详细描述**                                                                      |
| ---------- | --------------------------------------------------------------------------------- |
| 登录方式   | 1.手机号+密码登录；2. 微信快捷登录（自动绑定手机号，需短信验证）；3. 忘记密码入口 |
| 登录验证   | 密码错误提示、账号禁用提示、网络异常提示                                          |

#### 2.2.1.2 注册页


| **功能项** | **详细描述**                                                                                                                           |
| ---------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| 注册流程   | 1.输入手机号→获取短信验证码（6位，有效5分钟）；2.设置登录密码（8-16位，含字母+数字）；3.同意用户协议→完成注册；4. 注册成功后自动登录 |
| 校验规则   | 手机号格式校验、验证码正确性校验、密码强度校验                                                                                         |

#### 2.2.1.3 密码找回页


| **功能项** | **详细描述**                                                                  |
| ---------- | ----------------------------------------------------------------------------- |
| 找回流程   | 1.输入手机号→获取短信验证码；2.验证通过后设置新密码；3. 重置成功后跳转登录页 |

### 2.2.2 电池列表（终端用户核心页面）


| **功能项**   | **详细描述**                                                                                                                                                                                                |
| ------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 设备展示     | 1.列表样式：卡片式展示，每卡片显示设备名称（可自定义）、型号、SOC（百分比+进度条）、在线状态（蓝牙连接/MQTT在线/离线）；2. 排序方式：按绑定时间（默认）、SOC（从高到低）                                    |
| 扫码添加电池 | 1.点击“+”号→打开相机扫码（设备二维码含序列号、型号、设备秘钥）；2.扫码后验证设备合法性（是否未激活/已分配给对应经销商）；3.验证通过→确认绑定→添加到列表；4. 绑定失败提示（如设备已被绑定、设备未分配） |
| 设备操作     | 1.长按设备卡片：支持重命名、解绑设备（解绑后设备回归“未激活”状态）；2. 点击卡片：进入电池控制面板                                                                                                         |
| 刷新与筛选   | 下拉刷新设备状态；支持按状态（在线/离线/告警）筛选                                                                                                                                                          |

### 2.2.3 电池控制面板

#### 2.2.3.1 仪表盘


| **功能项**   | **详细描述**                                                                                                                                                                                                                          |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 实时数据展示 | 1.核心数据：电压（V）、电流（A，充电为正/放电为负）、功率（W）、SOC（剩余电量%）、SOH（健康状态%）、质保到期日；2.数据更新频率：蓝牙连接时1秒/次，MQTT连接时3秒/次；3. 状态标识：充电中/放电中/静置状态、均衡状态（是否正在电芯均衡） |
| 快捷指令     | 重启设备、清除告警（需蓝牙/MQTT在线）                                                                                                                                                                                                 |

#### 2.2.3.2 电芯


| **功能项**   | **详细描述**                                                                                                                                                                                           |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 电芯数据展示 | 1.列表/矩阵视图切换：显示每个电芯的编号、电压（V）、温度（℃）；2.异常标注：电芯电压/温度超出阈值时标红；3.均衡状态：显示当前是否均衡、均衡进度；4. 数据统计：最高/最低电芯电压、电压差、最高/最低温度 |

#### 2.2.3.3 OTA升级


| **功能项** | **详细描述**                                                                                                                                                                                                                                                               |
| ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 升级管理   | 1.版本信息：显示当前固件版本、最新版本、更新日志；2.升级操作：点击“立即升级”→下载固件（显示下载进度）→验证固件→发送升级指令；3.升级状态：等待升级/升级中（禁止关机提示）/升级成功/升级失败（显示失败原因，支持重试）；4. 离线升级：支持下载固件后，设备上线后自动升级 |

### 2.2.4 告警


| **功能项** | **详细描述**                                                                                                                                                                          |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 告警列表   | 1.筛选条件：设备、告警级别（紧急/重要/一般）、告警状态（未处理/已处理）、时间范围；2.列表字段：告警时间、设备名称、告警类型（过压/欠压/过温/过流/电芯不均衡等）、告警级别、处理状态； |
| 告警处理   | 1.点击告警→查看详情（含告警描述、建议处理方式）；2.标记为已处理（填写处理备注）；3. 历史告警：支持查询所有已处理/未处理告警                                                          |

2.2.5. 参数设置（见富嘉电源小程序-高级-，密码默认999000


| **功能项** | **详细描述****,如下图**                                       | **备注** |
| ---------- | ------------------------------------------------------------- | -------- |
| 电压参数   | ![]()                                                         |          |
| 电流参数   |                                                               |          |
| 温度参数   | MOS 过温保护放电过温保护放电低温保护充电过温保护充电低温保护 |          |

### 2.2.6我的


| **功能项** | **详细描述**                                                                     |
| ---------- | -------------------------------------------------------------------------------- |
| 个人信息   | 显示手机号、绑定设备数、注册时间；支持修改昵称、头像                             |
| 系统设置   | 1.蓝牙自动连接（开启后靠近设备自动连接）；2. 清除缓存（APP端）                   |
| 帮助与反馈 | 1.常见问题（FAQ）；2.意见反馈（输入文本+上传图片）；3. 联系客服（跳转电话/微信） |
| 关于我们   | 版本号、用户协议、隐私政策、厂家信息                                             |
| 退出登录   | 确认退出后清除当前登录状态，返回登录页                                           |